### 溪梦框架

#### 框架简介
使用 Python3 开发，通过对接 [go-cqhttp](https://docs.go-cqhttp.org/) 的 Api 接口运行的简易框架，
并对 [go-cqhttp](https://docs.go-cqhttp.org/) 部分 Api 和 Event 用以函数的形式做了简易封装。
但是在进阶级插件开发，以及运行效率上会比较受限，
且总体效率可能低于 [NoneBot](https://nb2.baka.icu/)， 
文档目前还在撰写中...

>由于一时半会读不懂 [NoneBot](https://nb2.baka.icu/) 的插件开发文档，索性自己写了一个框架的屑萌新（各位大佬轻喷！！！！）

- 早期版本可前往 [Release](https://github.com/funnygeeker/XiMeng/releases) 下载

!>注意：
由于溪梦框架仍在开发中，暂未发布正式版，本文档将仅保留最新版的文档，被遗弃的功能的文档将会被从文档中删除，如有需要，请在旧版本的 [Release](https://github.com/funnygeeker/XiMeng/releases) 中下载源码，并在解压后的 docs 目录查找文档

!>注意：2.0正式版发布前插件规范可能会频繁迭代（微调为主），如果您是插件开发者，请密切关注最新版插件开发文档，以保证插件对最新框架的兼容性。

#### 问题反馈
您可以通过 [兔小巢](https://support.qq.com/product/464061) 或者 [Github](https://github.com/funnygeeker/keiyume) 又或者 [加入QQ群](https://jq.qq.com/?_wv=1027&k=aCSDHr8h) 向我们反馈问题和提出建议

#### 查看说明文档
社区服务器：[溪梦文档站](https://docs.keiyume.com/keiyume) （最新消息和内容）
稳定服务器：[Github Pages](https://funnygeeker.github.io/keiyume) （稳定的服务器）


### 框架原理

#### 执行流程
- 启动框架时，会先加载基本配置文件，根据配置文件设置日志记录器（DEBUG模式可以查看更多详细日志）
- 当框架每接收到一个来自 [go-cqhttp](https://docs.go-cqhttp.org/) 上报的消息，将会为对应的消息开一个单独的线程，用于处理消息
- 收到消息后，先按顺序运行消息处理前置插件，前置插件对消息内容进行修改后传递给框架识别处理
- 之后调用后置插件，每个插件分别处理消息并修改消息的原始内容（如果需要）然后传递给后续插件
- 如果有出现调用 API 的情况，将会在调用 API 后阻塞线程，等待主线程接收到返回值后继续
- 接收到消息的 API 函数会返回结果数据，若超时则可能会报错并返回 None
- 对应消息线程的所有插件执行结束后，线程将被关闭

#### 线程说明
- 本框架采用多线程，每条消息的处理都会单独开一个线程，消息处理完毕则关闭线程
- 主线程：管理基本的通信，每接收到消息则新开一个线程处理消息
- 命令线程：用于处理在控制台上输入的命令，仅在连接正常时开启
- 任务线程：由 [APScheduler](https://pypi.org/project/APScheduler/) 管理计划任务
- 消息线程：数量不定，用于处理消息

#### 版本要求
- 仅支持 **Python3.7** 或更高的 Python3 版本

#### 通信方式
- 与 go-cqhttp 进行**正向 WebSocket** 通信

### 注意事项
- 此框架是由一个刚完成完全入门的 Python 小白编写的，请**各位大佬轻喷**
- 另外，框架中的部分代码可能存与 Python 代码标准标准不一致的部分
- 请各位小白**慎重参考**其中的代码，以免出现不好的习惯！
- 若框架存在设计缺陷或规范缺陷，请指出，感激不尽！

!> 此文档为早期版本，说明并不完善，也可能存在错误，如有错误请加群进行反馈，或在 Github 中提出